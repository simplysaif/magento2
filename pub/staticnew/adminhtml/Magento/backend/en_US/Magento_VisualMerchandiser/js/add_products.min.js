/*@api*/
define(['jquery','Magento_Ui/js/core/app','uiRegistry','Magento_Ui/js/modal/modal','mage/translate'],function($,bootstrap,registry){'use strict';$.widget('mage.visualMerchandiserAddProducts',{options:{dialogUrl:null,dialogButton:null},isGridLoaded:false,registry:null,positionCacheName:'position_cache_valid',selectedFromCache:'selected_cache',massAssign:'mass_assign',_create:function(){this.registry=registry;this.bootstrap=bootstrap;this.element.modal(this._getConfig());this._bind();},_bind:function(){this._on({requestUpdate:this.updateGrid,requestReload:this.reloadGrid});$(document).on('click',this.options.dialogButton,$.proxy(this.openDialog,this));},openDialog:function(){this.element.modal('openModal');},closeDialog:function(){this.element.modal('closeModal');},updateGrid:function(){this.registry.get('merchandiser_product_listing.merchandiser_product_listing_data_source').reload({refresh:true});},reloadGrid:function(event,action){var selectedFromCache=registry.get(this.selectedFromCache),indexOfCacheResult,i;if(action.action==='remove'){selectedFromCache=JSON.parse(selectedFromCache);for(i=0;i<action.ids.length;i++){indexOfCacheResult=selectedFromCache.indexOf(action.ids[i]);indexOfCacheResult>=0&&selectedFromCache.splice(indexOfCacheResult,1);}
registry.set(this.selectedFromCache,JSON.stringify(selectedFromCache));registry.set(this.massAssign,true);this.updateGrid();}else if(action.action==='assign'){selectedFromCache=JSON.parse(selectedFromCache);for(i=0;i<action.ids.length;i++){selectedFromCache.indexOf(action.ids[i])!==-1||selectedFromCache.push(action.ids[i]);}
registry.set(this.selectedFromCache,JSON.stringify(selectedFromCache));registry.set(this.massAssign,true);this.updateGrid();}else{this._invalidateCache();this.updateGrid();}},_invalidateCache:function(){this.registry.set(this.positionCacheName,false);this.registry.set(this.selectedFromCache,JSON.stringify([]));},_getConfig:function(){return{title:$.mage.__('Add Products'),opened:$.proxy(this._opened,this),buttons:this._getButtonsConfig()};},_opened:function(){if(!this.isGridLoaded){this._invalidateCache();$.ajax({type:'GET',url:this.options.dialogUrl,context:$('body'),dataType:'json',success:$.proxy(this._ajaxSuccess,this)});}else{this._invalidateCache();this.updateGrid();}},_ajaxSuccess:function(data){this._validateAjax(data);this.bootstrap(data);this.isGridLoaded=true;},_validateAjax:function(response){if(response.ajaxExpired&&response.ajaxRedirect){setLocation(response.ajaxRedirect);}else if(response.url){setLocation(response.url);}},_getButtonsConfig:function(){return[{text:$.mage.__('Save and Close'),class:'',click:$.proxy(this._save,this)}];},_save:function(){var idColumn=this.registry.get('merchandiser_product_listing.merchandiser_product_listing.merchandiser_product_columns.ids');this._invalidateCache();this._trigger('dialogSave',null,[idColumn.selected(),this]);}});return $.mage.visualMerchandiserAddProducts;});