define(['jquery','amazonCore','amazonPaymentConfig','amazonCsrf','mage/loader','jquery/ui','mage/cookies'],function($,amazonCore,amazonPaymentConfig,amazonCsrf){'use strict';var self;$.widget('amazon.AmazonRedirect',{_create:function(){self=this;$('body').trigger('processStart');this.redirectOnInvalidState();this.redirectOnRequestWithError();this.setAuthStateCookies();amazonCore.amazonDefined.subscribe(function(){amazon.Login.setUseCookie(true);amazonCore.verifyAmazonLoggedIn().then(function(loggedIn){if(loggedIn){self.redirect();}},0);},this);},getURLParameter:function(name,source){return decodeURIComponent((new RegExp('[?|&|#]'+name+'='+'([^&]+?)(&|#|;|$)').exec(source)||[,''])[1].replace(/\+/g,'%20'))||null;},setAuthStateCookies:function(){var token=this.getURLParameter('access_token',location.hash);if(typeof token==='string'&&token.match(/^Atza/)){$.mage.cookies.set('amazon_Login_accessToken',token);}
return true;},redirect:function(){window.location=amazonPaymentConfig.getValue('redirectUrl')+'?access_token='+
this.getURLParameter('access_token',location.hash);},redirectOnInvalidState:function(){var state=this.getURLParameter('state',location.hash);if(!state||!amazonCsrf.isValid(state)){window.location=amazonPaymentConfig.getValue('customerLoginPageUrl');}},redirectOnRequestWithError:function(){if(this.getURLParameter('error',window.location)){window.location=amazonPaymentConfig.getValue('customerLoginPageUrl');}}});return $.amazon.AmazonRedirect;});