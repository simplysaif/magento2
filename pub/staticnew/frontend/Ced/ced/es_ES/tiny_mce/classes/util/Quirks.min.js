(function(tinymce){var VK=tinymce.VK,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE;function cleanupStylesWhenDeleting(ed){var dom=ed.dom,selection=ed.selection;ed.onKeyDown.add(function(ed,e){var rng,blockElm,node,clonedSpan,isDelete;isDelete=e.keyCode==DELETE;if(isDelete||e.keyCode==BACKSPACE){e.preventDefault();rng=selection.getRng();blockElm=dom.getParent(rng.startContainer,dom.isBlock);if(isDelete)
blockElm=dom.getNext(blockElm,dom.isBlock);if(blockElm){node=blockElm.firstChild;while(node&&node.nodeType==3&&node.nodeValue.length==0)
node=node.nextSibling;if(node&&node.nodeName==='SPAN'){clonedSpan=node.cloneNode(false);}}
ed.getDoc().execCommand(isDelete?'ForwardDelete':'Delete',false,null);blockElm=dom.getParent(rng.startContainer,dom.isBlock);tinymce.each(dom.select('span.Apple-style-span,font.Apple-style-span',blockElm),function(span){var bm=selection.getBookmark();if(clonedSpan){dom.replace(clonedSpan.cloneNode(false),span,true);}else{dom.remove(span,true);}
selection.moveToBookmark(bm);});}});};function emptyEditorWhenDeleting(ed){ed.onKeyUp.add(function(ed,e){var keyCode=e.keyCode;if(keyCode==DELETE||keyCode==BACKSPACE){if(ed.dom.isEmpty(ed.getBody())){ed.setContent('',{format:'raw'});ed.nodeChanged();return;}}});};function inputMethodFocus(ed){ed.dom.bind(ed.getDoc(),'focusin',function(){ed.selection.setRng(ed.selection.getRng());});};function removeHrOnBackspace(ed){ed.onKeyDown.add(function(ed,e){if(e.keyCode===BACKSPACE){if(ed.selection.isCollapsed()&&ed.selection.getRng(true).startOffset===0){var node=ed.selection.getNode();var previousSibling=node.previousSibling;if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==="hr"){ed.dom.remove(previousSibling);tinymce.dom.Event.cancel(e);}}}})}
function focusBody(ed){if(!Range.prototype.getClientRects){ed.onMouseDown.add(function(ed,e){if(e.target.nodeName==="HTML"){var body=ed.getBody();body.blur();setTimeout(function(){body.focus();},0);}});}};function selectControlElements(ed){ed.onClick.add(function(ed,e){e=e.target;if(/^(IMG|HR)$/.test(e.nodeName))
ed.selection.select(e);if(e.nodeName=='A'&&ed.dom.hasClass(e,'mceItemAnchor'))
ed.selection.select(e);ed.nodeChanged();});};function selectionChangeNodeChanged(ed){var lastRng,selectionTimer;ed.dom.bind(ed.getDoc(),'selectionchange',function(){if(selectionTimer){clearTimeout(selectionTimer);selectionTimer=0;}
selectionTimer=window.setTimeout(function(){var rng=ed.selection.getRng();if(!lastRng||!tinymce.dom.RangeUtils.compareRanges(rng,lastRng)){ed.nodeChanged();lastRng=rng;}},50);});}
function ensureBodyHasRoleApplication(ed){document.body.setAttribute("role","application");}
tinymce.create('tinymce.util.Quirks',{Quirks:function(ed){if(tinymce.isWebKit){cleanupStylesWhenDeleting(ed);emptyEditorWhenDeleting(ed);inputMethodFocus(ed);selectControlElements(ed);if(tinymce.isIDevice){selectionChangeNodeChanged(ed);}}
if(tinymce.isIE){removeHrOnBackspace(ed);emptyEditorWhenDeleting(ed);ensureBodyHasRoleApplication(ed);}
if(tinymce.isGecko){removeHrOnBackspace(ed);focusBody(ed);}}});})(tinymce);