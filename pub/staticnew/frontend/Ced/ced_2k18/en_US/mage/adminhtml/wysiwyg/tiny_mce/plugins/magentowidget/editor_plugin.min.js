tinyMCE.addI18n({en:{magentowidget:{'insert_widget':'Insert Widget'}}});(function(){tinymce.create('tinymce.plugins.MagentowidgetPlugin',{init:function(ed,url){ed.addCommand('mceMagentowidget',function(){widgetTools.openDialog(ed.settings['magentowidget_url']+'widget_target_id/'+ed.getElement().id+'/');});ed.addButton('magentowidget',{title:'magentowidget.insert_widget',cmd:'mceMagentowidget',image:url+'/img/icon.gif'});ed.onNodeChange.add(function(edi,cm,n){var widgetCode;cm.setActive('magentowidget',false);if(n.id&&n.nodeName=='IMG'){widgetCode=Base64.idDecode(n.id);if(widgetCode.indexOf('{{widget')!==-1){cm.setActive('magentowidget',true);}}});ed.onDblClick.add(function(edi,e){var n=e.target,widgetCode;if(n.id&&n.nodeName=='IMG'){widgetCode=Base64.idDecode(n.id);if(widgetCode.indexOf('{{widget')!==-1){edi.execCommand('mceMagentowidget');}}});},getInfo:function(){return{longname:'Magento Widget Manager Plugin for TinyMCE 3.x',author:'Magento Core Team',authorurl:'http://magentocommerce.com',infourl:'http://magentocommerce.com',version:'1.0'};}});tinymce.PluginManager.add('magentowidget',tinymce.plugins.MagentowidgetPlugin);})();