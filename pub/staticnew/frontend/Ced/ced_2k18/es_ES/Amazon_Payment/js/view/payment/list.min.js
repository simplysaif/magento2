define(['jquery','underscore','ko','Magento_Checkout/js/view/payment/list','Magento_Checkout/js/model/payment/method-list','Magento_Checkout/js/model/checkout-data-resolver','Magento_Checkout/js/model/address-converter','Magento_Checkout/js/model/quote','Amazon_Payment/js/action/populate-shipping-address','Amazon_Payment/js/model/storage'],function($,_,ko,Component,paymentMethods,checkoutDataResolver,addressConverter,quote,populateShippingAddress,amazonStorage){'use strict';var self;return Component.extend({initialize:function(){self=this;this._hidePaymentMethodsOnLoad();paymentMethods.subscribe(function(changes){checkoutDataResolver.resolvePaymentMethod();_.each(changes,function(change){if(this._shouldRemovePaymentMethod(change.value.method)){this.removeRenderer(change.value.method);change.status='deleted';}},this);},this,'arrayChange');this._setupDeclineHandler();this._super();return this;},_shouldRemovePaymentMethod:function(method){return amazonStorage.isAmazonAccountLoggedIn()&&method!=='amazon_payment'&&method!=='free';},_setupDeclineHandler:function(){amazonStorage.amazonDeclineCode.subscribe(function(declined){switch(declined){case 4273:populateShippingAddress();amazonStorage.amazonlogOut();this._reloadPaymentMethods();amazonStorage.amazonDeclineCode(false);break;case 7638:amazonStorage.isPlaceOrderDisabled(true);this._reInitializeAmazonWalletWidget();this._hideEditableOptions();amazonStorage.amazonDeclineCode(false);break;default:amazonStorage.amazonDeclineCode(false);break;}},this);},_hidePaymentMethodsOnLoad:function(){if(paymentMethods().length>0){$(document).on('rendered','#amazon_payment',function(){_.each(paymentMethods(),function(payment){if(this._shouldRemovePaymentMethod(payment.method)){this.removeRenderer(payment.method);}},self);});}},_reloadPaymentMethods:function(){_.each(paymentMethods(),function(paymentMethodData){if(paymentMethodData.method==='amazon_payment'&&!amazonStorage.isAmazonAccountLoggedIn()){this.removeRenderer(paymentMethodData.method);}else{this.createRenderer(paymentMethodData);}},this);},_reInitializeAmazonWalletWidget:function(){var child=this.getChild('amazon_payment');if(child){child.renderPaymentWidget();}},_hideEditableOptions:function(){$('.payment-option.discount-code','#payment').remove();$('.action-edit','.shipping-information').remove();$('.opc-progress-bar-item._complete','.opc-progress-bar').addClass('lock-step');}});});