(function(tinymce){var Event=tinymce.dom.Event,each=tinymce.each;tinymce.create('tinymce.ui.KeyboardNavigation',{KeyboardNavigation:function(settings,dom){var t=this,root=settings.root,items=settings.items,enableUpDown=settings.enableUpDown,enableLeftRight=settings.enableLeftRight||!settings.enableUpDown,excludeFromTabOrder=settings.excludeFromTabOrder,itemFocussed,itemBlurred,rootKeydown,rootFocussed,focussedId;dom=dom||tinymce.DOM;itemFocussed=function(evt){focussedId=evt.target.id;};itemBlurred=function(evt){dom.setAttrib(evt.target.id,'tabindex','-1');};rootFocussed=function(evt){var item=dom.get(focussedId);dom.setAttrib(item,'tabindex','0');item.focus();};t.focus=function(){dom.get(focussedId).focus();};t.destroy=function(){each(items,function(item){dom.unbind(dom.get(item.id),'focus',itemFocussed);dom.unbind(dom.get(item.id),'blur',itemBlurred);});dom.unbind(dom.get(root),'focus',rootFocussed);dom.unbind(dom.get(root),'keydown',rootKeydown);items=dom=root=t.focus=itemFocussed=itemBlurred=rootKeydown=rootFocussed=null;t.destroy=function(){};};t.moveFocus=function(dir,evt){var idx=-1,controls=t.controls,newFocus;if(!focussedId)
return;each(items,function(item,index){if(item.id===focussedId){idx=index;return false;}});idx+=dir;if(idx<0){idx=items.length-1;}else if(idx>=items.length){idx=0;}
newFocus=items[idx];dom.setAttrib(focussedId,'tabindex','-1');dom.setAttrib(newFocus.id,'tabindex','0');dom.get(newFocus.id).focus();if(settings.actOnFocus){settings.onAction(newFocus.id);}
if(evt)
Event.cancel(evt);};rootKeydown=function(evt){var DOM_VK_LEFT=37,DOM_VK_RIGHT=39,DOM_VK_UP=38,DOM_VK_DOWN=40,DOM_VK_ESCAPE=27,DOM_VK_ENTER=14,DOM_VK_RETURN=13,DOM_VK_SPACE=32;switch(evt.keyCode){case DOM_VK_LEFT:if(enableLeftRight)t.moveFocus(-1);break;case DOM_VK_RIGHT:if(enableLeftRight)t.moveFocus(1);break;case DOM_VK_UP:if(enableUpDown)t.moveFocus(-1);break;case DOM_VK_DOWN:if(enableUpDown)t.moveFocus(1);break;case DOM_VK_ESCAPE:if(settings.onCancel){settings.onCancel();Event.cancel(evt);}
break;case DOM_VK_ENTER:case DOM_VK_RETURN:case DOM_VK_SPACE:if(settings.onAction){settings.onAction(focussedId);Event.cancel(evt);}
break;}};each(items,function(item,idx){var tabindex;if(!item.id){item.id=dom.uniqueId('_mce_item_');}
if(excludeFromTabOrder){dom.bind(item.id,'blur',itemBlurred);tabindex='-1';}else{tabindex=(idx===0?'0':'-1');}
dom.setAttrib(item.id,'tabindex',tabindex);dom.bind(dom.get(item.id),'focus',itemFocussed);});if(items[0]){focussedId=items[0].id;}
dom.setAttrib(root,'tabindex','-1');dom.bind(dom.get(root),'focus',rootFocussed);dom.bind(dom.get(root),'keydown',rootKeydown);}});})(tinymce);