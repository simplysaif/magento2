define(['jquery','prototype'],function(jQuery){'use strict';var categorySubmit=function(){var activeTab=$('active_tab_id'),params={},fields,i,categoryId,isCreating,path,parentId,currentNode,oldClass,newClass;if(activeTab){if(activeTab.tabsJsObject&&activeTab.tabsJsObject.tabs('activeAnchor')){activeTab.value=activeTab.tabsJsObject.tabs('activeAnchor').prop('id');}}
fields=$('category_edit_form').getElementsBySelector('input','select');for(i=0;i<fields.length;i++){if(!fields[i].name){continue;}
params[fields[i].name]=fields[i].getValue();}
categoryId=params['general[id]']?params['general[id]']:0;isCreating=categoryId==0;path=params['general[path]'].split('/');parentId=path.pop();if(parentId==categoryId){parentId=path.pop();}
if(isCreating){if(!tree.currentNodeId){tree.currentNodeId=parentId;}
tree.addNodeTo=parentId;}else{if(tree&&tree.storeId==0){currentNode=tree.getNodeById(categoryId);if(currentNode){if(parseInt(params['general[is_active]'])){oldClass='no-active-category';newClass='active-category';}else{oldClass='active-category';newClass='no-active-category';}
Element.removeClassName(currentNode.ui.wrap.firstChild,oldClass);Element.addClassName(currentNode.ui.wrap.firstChild,newClass);}}}
jQuery('#category_edit_form').trigger('submit');};return function(config,element){config=config||{};jQuery(element).on('click',function(){categorySubmit(config.url,config.ajax);});};});