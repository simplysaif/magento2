define(['jquery'],function($){'use strict';$.widget('mage.visualMerchandiserTilePager',{options:{'gridUrl':null,'varNamePage':null,'limitControl':'[data-role=page_limiter]','prevControl':'[data-role=button_previous]','nextControl':'[data-role=button_next]','inputControl':'[data-role=input_page]'},_create:function(){this.reloadParams=false;this.url=this.options.gridUrl;this._bind();},_bind:function(){this._bindElement($(this.options.limitControl),this.loadByElement);this._bindElement($(this.options.prevControl),this.setPage);this._bindElement($(this.options.nextControl),this.setPage);this._bindElement($(this.options.inputControl),this.inputPage);},_bindElement:function(element,callback){if(element.is('select')){element.on('change',$.proxy(callback,this));}else if(element.is('button')){element.on('click',$.proxy(callback,this));}else if(element.is('input')){element.on('keypress',$.proxy(callback,this));}},reload:function(url){var ajaxRequest,ajaxSettings;this.reloadParams=this.reloadParams||{};this.reloadParams.form_key=FORM_KEY;url=url||this.url;ajaxSettings={url:url+(url.match(new RegExp('\\?'))?'&ajax=true':'?ajax=true'),showLoader:true,method:'post',context:this.element,data:this.reloadParams,dataType:'html',success:$.proxy(this._onAjaxSuccess,this)};this.element.trigger('gridajaxsettings',ajaxSettings);ajaxRequest=$.ajax(ajaxSettings);this.element.trigger('gridajax',ajaxRequest);},setPage:function(event){var pageNumber=$(event.target).attr('data-value');this.reload(this.addVarToUrl(this.options.varNamePage,pageNumber));},inputPage:function(event){var keyCode=event.keyCode||event.which,element=$(Event.element(event));if(keyCode===Event.KEY_RETURN){this.reload(this.addVarToUrl(this.options.varNamePage,element.val()));}},loadByElement:function(event){var element=event.target;if(element&&element.name){this.reload(this.addVarToUrl(element.name,element.value));}},_onAjaxSuccess:function(data,textStatus,transport){var html=$('<div />').append(transport.responseText).find('>div').html();this.element.html(html);this.element.trigger('contentUpdated');this._bind();},_addVarToUrl:function(url,varName,varValue){var re=new RegExp('\/('+varName+'\/.*?\/)'),parts=url.split(new RegExp('\\?'));url=parts[0].replace(re,'/');url+=varName+'/'+varValue+'/';if(parts.size()>1){url+='?'+parts[1];}
return url;},addVarToUrl:function(varName,varValue){this.url=this._addVarToUrl(this.url,varName,varValue);return this.url;}});return $.mage.visualMerchandiserTilePager;});