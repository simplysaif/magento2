(function(tinymce){var DOM=tinymce.DOM,Event=tinymce.dom.Event,each=tinymce.each,Dispatcher=tinymce.util.Dispatcher;tinymce.create('tinymce.ui.ListBox:tinymce.ui.Control',{ListBox:function(id,s,ed){var t=this;t.parent(id,s,ed);t.items=[];t.onChange=new Dispatcher(t);t.onPostRender=new Dispatcher(t);t.onAdd=new Dispatcher(t);t.onRenderMenu=new tinymce.util.Dispatcher(this);t.classPrefix='mceListBox';},select:function(va){var t=this,fv,f;if(va==undefined)
return t.selectByIndex(-1);if(va&&va.call)
f=va;else{f=function(v){return v==va;};}
if(va!=t.selectedValue){each(t.items,function(o,i){if(f(o.value)){fv=1;t.selectByIndex(i);return false;}});if(!fv)
t.selectByIndex(-1);}},selectByIndex:function(idx){var t=this,e,o,label;if(idx!=t.selectedIndex){e=DOM.get(t.id+'_text');label=DOM.get(t.id+'_voiceDesc');o=t.items[idx];if(o){t.selectedValue=o.value;t.selectedIndex=idx;DOM.setHTML(e,DOM.encode(o.title));DOM.setHTML(label,t.settings.title+" - "+o.title);DOM.removeClass(e,'mceTitle');DOM.setAttrib(t.id,'aria-valuenow',o.title);}else{DOM.setHTML(e,DOM.encode(t.settings.title));DOM.setHTML(label,DOM.encode(t.settings.title));DOM.addClass(e,'mceTitle');t.selectedValue=t.selectedIndex=null;DOM.setAttrib(t.id,'aria-valuenow',t.settings.title);}
e=0;}},add:function(n,v,o){var t=this;o=o||{};o=tinymce.extend(o,{title:n,value:v});t.items.push(o);t.onAdd.dispatch(t,o);},getLength:function(){return this.items.length;},renderHTML:function(){var h='',t=this,s=t.settings,cp=t.classPrefix;h='<span role="listbox" aria-haspopup="true" aria-labelledby="'+t.id+'_voiceDesc" aria-describedby="'+t.id+'_voiceDesc"><table role="presentation" tabindex="0" id="'+t.id+'" cellpadding="0" cellspacing="0" class="'+cp+' '+cp+'Enabled'+(s['class']?(' '+s['class']):'')+'"><tbody><tr>';h+='<td>'+DOM.createHTML('span',{id:t.id+'_voiceDesc','class':'voiceLabel',style:'display:none;'},t.settings.title);h+=DOM.createHTML('a',{id:t.id+'_text',tabindex:-1,href:'javascript:;','class':'mceText',onclick:"return false;",onmousedown:'return false;'},DOM.encode(t.settings.title))+'</td>';h+='<td>'+DOM.createHTML('a',{id:t.id+'_open',tabindex:-1,href:'javascript:;','class':'mceOpen',onclick:"return false;",onmousedown:'return false;'},'<span><span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25BC</span></span>')+'</td>';h+='</tr></tbody></table></span>';return h;},showMenu:function(){var t=this,p2,e=DOM.get(this.id),m;if(t.isDisabled()||t.items.length==0)
return;if(t.menu&&t.menu.isMenuVisible)
return t.hideMenu();if(!t.isMenuRendered){t.renderMenu();t.isMenuRendered=true;}
p2=DOM.getPos(e);m=t.menu;m.settings.offset_x=p2.x;m.settings.offset_y=p2.y;m.settings.keyboard_focus=!tinymce.isOpera;if(t.oldID)
m.items[t.oldID].setSelected(0);each(t.items,function(o){if(o.value===t.selectedValue){m.items[o.id].setSelected(1);t.oldID=o.id;}});m.showMenu(0,e.clientHeight);Event.add(DOM.doc,'mousedown',t.hideMenu,t);DOM.addClass(t.id,t.classPrefix+'Selected');},hideMenu:function(e){var t=this;if(t.menu&&t.menu.isMenuVisible){DOM.removeClass(t.id,t.classPrefix+'Selected');if(e&&e.type=="mousedown"&&(e.target.id==t.id+'_text'||e.target.id==t.id+'_open'))
return;if(!e||!DOM.getParent(e.target,'.mceMenu')){DOM.removeClass(t.id,t.classPrefix+'Selected');Event.remove(DOM.doc,'mousedown',t.hideMenu,t);t.menu.hideMenu();}}},renderMenu:function(){var t=this,m;m=t.settings.control_manager.createDropMenu(t.id+'_menu',{menu_line:1,'class':t.classPrefix+'Menu mceNoIcons',max_width:150,max_height:150});m.onHideMenu.add(function(){t.hideMenu();t.focus();});m.add({title:t.settings.title,'class':'mceMenuItemTitle',onclick:function(){if(t.settings.onselect('')!==false)
t.select('');}});each(t.items,function(o){if(o.value===undefined){m.add({title:o.title,role:"option",'class':'mceMenuItemTitle',onclick:function(){if(t.settings.onselect('')!==false)
t.select('');}});}else{o.id=DOM.uniqueId();o.role="option";o.onclick=function(){if(t.settings.onselect(o.value)!==false)
t.select(o.value);};m.add(o);}});t.onRenderMenu.dispatch(t,m);t.menu=m;},postRender:function(){var t=this,cp=t.classPrefix;Event.add(t.id,'click',t.showMenu,t);Event.add(t.id,'keydown',function(evt){if(evt.keyCode==32){t.showMenu(evt);Event.cancel(evt);}});Event.add(t.id,'focus',function(){if(!t._focused){t.keyDownHandler=Event.add(t.id,'keydown',function(e){if(e.keyCode==40){t.showMenu();Event.cancel(e);}});t.keyPressHandler=Event.add(t.id,'keypress',function(e){var v;if(e.keyCode==13){v=t.selectedValue;t.selectedValue=null;Event.cancel(e);t.settings.onselect(v);}});}
t._focused=1;});Event.add(t.id,'blur',function(){Event.remove(t.id,'keydown',t.keyDownHandler);Event.remove(t.id,'keypress',t.keyPressHandler);t._focused=0;});if(tinymce.isIE6||!DOM.boxModel){Event.add(t.id,'mouseover',function(){if(!DOM.hasClass(t.id,cp+'Disabled'))
DOM.addClass(t.id,cp+'Hover');});Event.add(t.id,'mouseout',function(){if(!DOM.hasClass(t.id,cp+'Disabled'))
DOM.removeClass(t.id,cp+'Hover');});}
t.onPostRender.dispatch(t,DOM.get(t.id));},destroy:function(){this.parent();Event.clear(this.id+'_text');Event.clear(this.id+'_open');}});})(tinymce);