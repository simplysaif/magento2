define(['jquery','Magento_Theme/js/model/breadcrumb-list'],function($,breadcrumbList){'use strict';return function(widget){$.widget('mage.breadcrumbs',widget,{options:{categoryUrlSuffix:'',useCategoryPathInUrl:false,product:'',menuContainer:'[data-action="navigation"] > ul'},_init:function(){var menu;menu=$(this.options.menuContainer).data('mageMenu');if(typeof menu==='undefined'){$(this.options.menuContainer).on('menucreate',function(){this._super();}.bind(this));}else{this._super();}},_render:function(){this._appendCatalogCrumbs();this._super();},_appendCatalogCrumbs:function(){var categoryCrumbs=this._resolveCategoryCrumbs();categoryCrumbs.forEach(function(crumbInfo){breadcrumbList.push(crumbInfo);});if(this.options.product){breadcrumbList.push(this._getProductCrumb());}},_resolveCategoryCrumbs:function(){var menuItem=this._resolveCategoryMenuItem(),categoryCrumbs=[];if(menuItem!==null&&menuItem.length){categoryCrumbs.unshift(this._getCategoryCrumb(menuItem));while((menuItem=this._getParentMenuItem(menuItem))!==null){categoryCrumbs.unshift(this._getCategoryCrumb(menuItem));}}
return categoryCrumbs;},_getCategoryCrumb:function(menuItem){var categoryId,categoryName,categoryUrl;categoryId=/(\d+)/i.exec(menuItem.attr('id'))[0];categoryName=menuItem.text();categoryUrl=menuItem.attr('href');return{'name':'category'+categoryId,'label':categoryName,'link':categoryUrl,'title':''};},_getProductCrumb:function(){return{'name':'product','label':this.options.product,'link':'','title':''};},_getParentMenuItem:function(menuItem){var classes,classNav,parentClass,parentMenuItem=null;if(!menuItem){return null;}
classes=menuItem.parent().attr('class');classNav=classes.match(/(nav\-)[0-9]+(\-[0-9]+)+/gi);if(classNav){classNav=classNav[0];parentClass=classNav.substr(0,classNav.lastIndexOf('-'));if(parentClass.lastIndexOf('-')!==-1){parentMenuItem=$(this.options.menuContainer).find('.'+parentClass+' > a');parentMenuItem=parentMenuItem.length?parentMenuItem:null;}}
return parentMenuItem;},_resolveCategoryMenuItem:function(){var categoryUrl=this._resolveCategoryUrl(),menu=$(this.options.menuContainer),categoryMenuItem=null;if(categoryUrl&&menu.length){categoryMenuItem=menu.find('a[href="'+categoryUrl+'"]');}
return categoryMenuItem;},_resolveCategoryUrl:function(){var categoryUrl;if(this.options.useCategoryPathInUrl){categoryUrl=window.location.href.split('?')[0];categoryUrl=categoryUrl.substring(0,categoryUrl.lastIndexOf('/'))+
this.options.categoryUrlSuffix;}else{categoryUrl=document.referrer;if(categoryUrl.indexOf('?')>0){categoryUrl=categoryUrl.substr(0,categoryUrl.indexOf('?'));}}
return categoryUrl;}});return $.mage.breadcrumbs;};});